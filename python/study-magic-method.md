# Python 魔术方法、特殊属性、特殊文件

官方文档：https://docs.python.org/zh-cn/3/reference/datamodel.html

下面的内容仅对魔术方法、特殊属性、特殊文件进行简单描述，详细内容查看官方文档。

## **常用魔术方法**：

| 方法名                          | 说明                                                         | 使用代码                            | 建议 |
| ------------------------------- | ------------------------------------------------------------ | ----------------------------------- | ---- |
| \__new__(cls[, ...])            | 创建cls类未初始化的实例对象，并返回创建的实例, 必须返回实例否则不会运行\__init__方法。在创建类的实例对象时自动调用。 | obj = Test()                        |      |
| \__init__(self[, ...])          | 将\__new__方法创建的实例初始化, 只能返回None。在创建类的实例对象时自动调用。 | obj = Test()                        |      |
| \__del__(self)                  | 在实例将被销毁时调用。del x并不会直接调用x.\__del__(),前者仅将x的引用计数减一。后者是x的引用计数为0时被调用。 |                                     |      |
| \__repr__(self)                 | 表述某个对象在内存中的展示形式，使用repr()会调用该方法。     | repr(obj)                           |      |
| \__str__(self)                  | 生成对象的适合打印的字符串表示。使用str()或print()会调用该方法。当对象未定义该方法，则会调用\__repr__方法。 | str(a), print(a)                    |      |
| \__eq__(self, other)            | 使用==会调用对象的\__eq__方法。                              | a == b                              |      |
| \__hash__(self)                 | 通过内置函数 [`hash()`](https://docs.python.org/zh-cn/3/library/functions.html#hash) 调用以对哈希集的成员进行操作, 返回一个整数。 | hase(a)                             |      |
| \__bool__(self)                 | 通过bool()方法自动调用，应当返回 `False` 或 `True`。如果\_\_bool\_\_与\_\_len\_\_都未定义，则实例始终为True。 | bool(a)                             |      |
| \__getattr__(self, name)        | 当对象访问属性引发 [`AttributeError`](https://docs.python.org/zh-cn/3/library/exceptions.html#AttributeError) 而失败时被调用，返回对象的name属性值。（仅在属性不存在时触发） |                                     |      |
| \__getattribute__(self, name)   | 在每次访问属性时都会触发（无论属性是否存在）。如果引发 [`AttributeError`](https://docs.python.org/zh-cn/3/library/exceptions.html#AttributeError) 会调用\__getattr__方法。该方法在属性获取之前调用，方法的返回值会作为属性查找的结果返回。 |                                     |      |
| \__setattr__(self, name, value) | 当对象的属性被赋值时被调用。这个调用会取代正常机制（即将值保存到实例字典）。 |                                     |      |
| \__delattr__(self, name)        | 类似于\__setattr__，方法仅在del obj.name对于该对象有意义时被调用。 |                                     |      |
| \__dir__(self)                  | 通过dir()自动调用， 返回可迭代对象。一般返回当前对象的有效属性列表（包括继承的属性和方法）。 | dir(a)                              |      |
| \__call__(self[, args...])      | 当实例通过"()"被调用时，会调用\__call__方法。                | t = Test()<br />t() # 调用\__call__ |      |
| \__len__(self)                  | 通过len()自动调用，返回一个>=0的整数。如果未定义\__bool__会在布尔判断中查看其返回值是否为0 | len(a)                              |      |
| \__getitem__(self, key)         | 对象使用索引器（[]）时会调用该方法。当调用self[key]时，调用\__getitem__方法。 | data[key]                           |      |
| \__setitem__(self,key, value)   | 当使用self[key] = value 时，调用\__setitem__方法             | data[key] = value                   |      |
| \__delitem__(self, key)         | 当调用del self[key]时，调用\__delitem__方法                  | del data[key]                       |      |
| \__missing__(self, key)         | 当\__getitem__找不到key时，调用\_\_missing\_\_方法           |                                     |      |

## **常用特殊属性**：

| 属性名           | 说明                                                         | 作用域           |
| ---------------- | ------------------------------------------------------------ | ---------------- |
| \__all__         | 如果没有定义 `__all__`，`import *` 会默认导入所有不以下划线 (`_`) 开头的名称。定义 `__all__` 可以精确控制导出内容。 | 模块级           |
| \__name__        | 类的名称。模块为主程序下：`__name__` == `"__main__"`, 其他情况返回类或函数的名字。 | 模块、类、函数级 |
| \__qualname__    | 类的限定名，从模块的全局作用域到当前类的路径。如： C.D.meth  | 类、函数级       |
| \__module__      | 类定义所在的模块名。当前类或函数在主模块下，返回`__main__`   | 类、函数级       |
| \__dict__        | 存储对象属性的字典。包括直接定义的**属性名和值的字典**，但不包括继承的属性与方法。实例的 `__dict__` 包含该实例的**实例属性**。类的 `__dict__` 包含该类的**类属性、方法等**。Python 类的每个实例都有一个 `__dict__` 字典，用于动态存储实例属性。 | 类级             |
| \__bases__       | 一个包含类的基类的元组。如：(A, B, C)                        | 类级             |
| \__doc__         | 文档字符串。当在模块、类或函数开头写字符串时，该字符串会赋值给 `__doc__` | 模块、类、函数级 |
| \__annotations__ | 存储代码中的类型注解                                         | 类、函数级       |
| \__class__       | 获取类实例所属的类                                           | 类、函数级       |
| \__slots__       | 显式声明类实例允许绑定的属性。`__slots__`的声明会阻止每个实例的`__dict__`与`__weakref__`的创建。作用：1.限制动态属性扩展(禁用了`__dict__`的创建) 2. 优化内存并提高访问效率（`__dict__`占用空间大于`__slots__`） | 类级             |
| \__file__        | 当前模块的文件路径，直接调用                                 | 模块级           |

## 特殊模块文件

### `__init__.py`

标识一个目录为python包，使该目录下的模块可以被导入。python 3.3+无需强制要求。

常常用来进行包级别的代码初始化以及使用`__all__`控制哪些模块被公开，可控制from package import *的行为。

### `__main__.py`

允许包作为一个可执行脚本运行。当运行`python -m package`时会调用包下的`__main__.py`文件。

### `__version__.py`

一个正常的文件，无特殊行为，一般用来定义包或模块的版本号。
